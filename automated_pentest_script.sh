#!/bin/bash

echo " _______  __   __  _______  __   __    _     _  _______  _______ "
echo "|       ||  | |  ||       ||  | |  |  | | _ | ||   _   ||       |"
echo "|    _  ||  |_|  ||    ___||  | |  |  | || || ||  |_|  ||    ___|"
echo "|   |_| ||       ||   |___ |  |_|  |  |       ||       ||   |___ "
echo "|    ___||       ||    ___||       |  |       ||       ||    ___|"
echo "|   |    |   _   ||   |___ |       |  |   _   ||   _   ||   |___ "
echo "|___|    |__| |__||_______||_______|  |__| |__||__| |__||_______|"








TARGET=metasploit.xx

#Running nmap.
echo
echo "----------=====----------=====----------=====----------"
echo "              Starting NMAP scan on [ $TARGET ]"
echo "----------=====----------=====----------=====----------"
echo
nmap -p- -T5 --open $TARGET > nmap-results_1.txt
grep -oP '\d+/tcp' nmap-results_1.txt | awk '{print $1}' | grep -oP '\d+' | awk '{print $1}' > ports.txt

#Remove first nmap results.
rm nmap-results_1.txt

#Read each port from the file and scan it.
while read -r port; do
    nmap -p "$port" -sS -sC -sV "$TARGET" >> nmap-results_2.txt
done < "ports.txt"

# Scan each port from the file and scan for services.
while read -r port; do
    nmap -p "$port" -sS -sV "$TARGET" >> avail_services.txt
done < "ports.txt"

cat avail_services.txt | sed '1d' | awk '/open/ {sub(/.*open[[:space:]]*/, ""); print}' > services.txt

#Running searchsploit
while read -r service; do
    if [ "$service" != "unknown" ]; then
        searchsploit "$service" >> searchsploit-results.txt
        echo >> searchsploit-results.txt
    else
        :
    fi
done < "services.txt"

echo
echo
echo "<--> <--> <--> <|==============[    Running Gobuster    ]============|> <--> <--> <-->"
echo
#Running Gobuster
while read -r port; do
    case "$port" in
        "80" | "443" | "8080")
        gobuster dir -u http://$TARGET -w /usr/share/dirb/wordlists/common.txt -o dir_busting_results.txt
        ;;
    esac
done < "ports.txt"

echo "|==-==-==-==-==-==-==-==-==-==-==-==-==-==-==-==-==-==-==-==-==-==-==-==-==-==-==-==-===|"
echo "  =-==-==-==-==-==-==-==-==-==-==- [AUTOMATION COMPLETE ] -==-==-==-==-==-==-==-==-==-"